<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800" viewBox="0 0 1200 800">
  <style>
    .box{fill:#f8f9fa;stroke:#2b2f33;stroke-width:1.5;rx:6}
    .title{font: bold 16px sans-serif; fill:#111}
    .label{font: 12px sans-serif; fill:#111}
    .small{font:10px sans-serif; fill:#333}
    .arrow{stroke:#2b2f33;stroke-width:1.2;fill:none;marker-end:url(#arrow)}
  </style>
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="6" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#2b2f33" />
    </marker>
  </defs>

  <!-- Frontend -->
  <rect x="40" y="40" width="220" height="80" class="box"/>
  <text x="60" y="65" class="title">Streamlit Frontend</text>
  <text x="60" y="85" class="small">UI: Chat, Market, Portfolio</text>

  <!-- API / Gateway -->
  <rect x="320" y="40" width="260" height="100" class="box"/>
  <text x="340" y="65" class="title">FastAPI Backend</text>
  <text x="340" y="85" class="small">REST endpoints (/chat, /market, /users, /portfolio)</text>

  <!-- Observability -->
  <rect x="620" y="40" width="240" height="80" class="box"/>
  <text x="640" y="65" class="title">Observability</text>
  <text x="640" y="85" class="small">LangSmith + Arize (safe no-op)</text>

  <!-- Arrows frontend -> backend -> observability -->
  <path d="M260,80 L320,80" class="arrow"/>
  <path d="M580,80 L620,80" class="arrow"/>

  <!-- Orchestrator / Agents -->
  <rect x="320" y="170" width="540" height="220" class="box"/>
  <text x="340" y="195" class="title">Orchestrator</text>
  <text x="340" y="215" class="small">Routes intents to agents</text>

  <!-- Agents list -->
  <text x="360" y="245" class="label">Educator • Market • Strategy • Portfolio Coach</text>
  <text x="360" y="265" class="label">Risk Profiler • Compliance</text>

  <!-- MCP Servers -->
  <rect x="900" y="170" width="240" height="140" class="box"/>
  <text x="920" y="195" class="title">MCP Servers</text>
  <text x="920" y="215" class="small">Market MCP (yFinance) • Portfolio MCP (DB)</text>
  <text x="920" y="235" class="small">Batching + per-ticker parallelism</text>

  <path d="M860,240 L900,240" class="arrow"/>
  <path d="M860,220 L900,220" class="arrow"/>

  <!-- Database -->
  <rect x="320" y="420" width="260" height="100" class="box"/>
  <text x="340" y="445" class="title">Database</text>
  <text x="340" y="465" class="small">SQLAlchemy: Users, Holdings, Transactions</text>

  <!-- Cache / Redis -->
  <rect x="620" y="420" width="240" height="100" class="box"/>
  <text x="640" y="445" class="title">Cache Layer</text>
  <text x="640" y="465" class="small">_quote_agg_cache (in-memory)</text>
  <text x="640" y="485" class="small">Optional Redis (REDIS_URL)</text>

  <!-- LLM Gateway -->
  <rect x="40" y="320" width="220" height="160" class="box"/>
  <text x="60" y="345" class="title">LLM Gateway</text>
  <text x="60" y="365" class="small">OpenAI / Gemini / Anthropic</text>
  <text x="60" y="385" class="small">Caching + provider fallback</text>

  <!-- Arrows: Orchestrator -> MCP, DB, LLM -->
  <path d="M680,280 L860,280" class="arrow"/>
  <path d="M560,280 L560,420" class="arrow"/>
  <path d="M420,280 L260,360" class="arrow"/>

  <!-- Notes -->
  <text x="40" y="500" class="small">Notes: batching reduces external calls; aggregation cache reduces duplicate quote fetches; observability traces runs when keys present.</text>

</svg>
